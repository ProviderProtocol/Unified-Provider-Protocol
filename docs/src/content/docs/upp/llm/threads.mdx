---
title: Threads
description: Thread utility for managing conversation history.
---

import { Aside, Badge, Card, CardGrid } from '@astrojs/starlight/components';

# Threads

<Badge text="UPP-1.2.0" variant="note" />

## Thread as Utility

`Thread` is an **optional** utility class for managing conversation history. UPP does not manage threads internally—users control their own history.

**Thread Structure:**

| Property | Type | Description |
|----------|------|-------------|
| `id` | String | Unique thread identifier |
| `messages` | List&lt;Message&gt; | All messages in the thread (read-only) |
| `length` | Integer | Number of messages |

**Thread Methods:**

| Method | Parameters | Return Type | Description |
|--------|------------|-------------|-------------|
| `append` | turn: Turn | Thread | Append messages from a turn |
| `push` | ...messages: Message[] | Thread | Add raw messages |
| `user` | content: String \| List&lt;ContentBlock&gt; | Thread | Add a user message |
| `assistant` | content: String \| List&lt;ContentBlock&gt; | Thread | Add an assistant message |
| `filter` | type: MessageType | List&lt;Message&gt; | Get messages by type |
| `tail` | count: Integer | List&lt;Message&gt; | Get the last N messages |
| `slice` | start?: Integer, end?: Integer | Thread | Create new thread with subset |
| `clear` | (none) | Thread | Clear all messages |
| `toMessages` | (none) | List&lt;Message&gt; | Convert to plain message array |
| `toJSON` | (none) | ThreadJSON | Serialize to JSON |
| (iterable) | — | Iterator&lt;Message&gt; | Thread is iterable over its messages |

**Thread Static Methods:**

| Method | Parameters | Return Type | Description |
|--------|------------|-------------|-------------|
| `fromJSON` | json: ThreadJSON | Thread | Deserialize from JSON |

## Thread Usage

```text
claude = llm({
  model: anthropic("claude-haiku-4-20250514"),
  config: { apiKey: env.ANTHROPIC_API_KEY },
  system: "You are a helpful assistant."
})

// Using Thread utility
thread = Thread()

turn1 = await claude.generate(thread, "My name is Bob.")
thread.append(turn1)

turn2 = await claude.generate(thread, "What did I just tell you?")
thread.append(turn2)

print(turn2.response.text)  // "You told me your name is Bob."
print(thread.length)        // 4 messages

// Serialize for storage
json = thread.toJSON()
storage.set("conversation", json)

// Restore later
restored = Thread.fromJSON(storage.get("conversation"))
```

## Using Raw Arrays

Threads are optional—you can use plain arrays:

```text
messages = []

turn = await claude.generate(messages, "Hello!")
messages.push(...turn.messages)
```

## Thread Serialization

**ThreadJSON Structure:**

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `id` | String | Yes | Unique thread identifier |
| `messages` | List&lt;MessageJSON&gt; | Yes | All messages in the thread |
| `createdAt` | String (ISO 8601) | Yes | Thread creation timestamp |
| `updatedAt` | String (ISO 8601) | Yes | Last update timestamp |

**MessageJSON Structure:**

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `id` | String | Yes | Unique message identifier |
| `type` | MessageType | Yes | "user", "assistant", or "tool_result" |
| `content` | List&lt;ContentBlock&gt; | Yes | Message content blocks |
| `toolCalls` | List&lt;ToolCall&gt; | No | Tool calls (assistant messages only) |
| `results` | List&lt;ToolResult&gt; | No | Tool results (tool_result messages only) |
| `metadata` | MessageMetadata | No | Provider-namespaced metadata |
| `timestamp` | String (ISO 8601) | Yes | Message timestamp |

**Example:**

```text
// ThreadJSON
{
  id: "thread_abc123",
  messages: [<MessageJSON>, ...],
  createdAt: "2024-01-15T10:30:00Z",
  updatedAt: "2024-01-15T10:35:00Z"
}

// MessageJSON
{
  id: "msg_xyz789",
  type: "assistant",
  content: [{ type: "text", text: "Hello!" }],
  toolCalls: [],
  metadata: {},
  timestamp: "2024-01-15T10:30:00Z"
}
```