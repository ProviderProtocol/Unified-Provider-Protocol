---
title: Error Handling
description: UPP error codes, retry strategies, and error normalization.
---

import { Aside, Badge } from '@astrojs/starlight/components';

# Error Handling

<Badge text="UPP-1.2" variant="note" />

UPP provides standardized error handling and retry strategies across all modalities.

## Error Structure

All modalities normalize errors to `UPPError`:

**UPPError Structure:**

| Field | Type | Description |
|-------|------|-------------|
| `message` | String | Human-readable error message |
| `code` | ErrorCode | Standardized error code |
| `provider` | String | Provider name (e.g., "anthropic") |
| `modality` | Modality | Which modality: "llm", "embedding", "image" |
| `statusCode` | Integer? | HTTP status code if applicable |
| `cause` | Error? | Original underlying error |

**ErrorCode Values:**

| Code | Description |
|------|-------------|
| `AUTHENTICATION_FAILED` | Invalid or missing API key |
| `RATE_LIMITED` | Too many requests |
| `CONTEXT_LENGTH_EXCEEDED` | Input exceeds model context limit |
| `MODEL_NOT_FOUND` | Requested model doesn't exist |
| `INVALID_REQUEST` | Malformed request |
| `INVALID_RESPONSE` | Response failed validation (e.g., structured output) |
| `CONTENT_FILTERED` | Content policy violation |
| `QUOTA_EXCEEDED` | Usage limits exceeded |
| `PROVIDER_ERROR` | Provider-side error |
| `NETWORK_ERROR` | Connection failure |
| `TIMEOUT` | Request timed out |
| `CANCELLED` | Operation was cancelled |

**Modality Values:**

| Value | Description |
|-------|-------------|
| `llm` | Large Language Model operations |
| `embedding` | Vector embedding operations |
| `image` | Image generation operations |
| `audio` | Audio operations (future) |
| `video` | Video operations (future) |

## Retry Strategies

**RetryStrategy Interface:**

| Method | Parameters | Return Type | Description |
|--------|------------|-------------|-------------|
| `onRetry` | error: UPPError, attempt: Integer | Integer \| null \| Promise | Returns delay in ms before retry, or null to stop |
| `beforeRequest` | (none) | Integer \| Promise&lt;Integer&gt; | Optional. Returns delay before making request (pre-emptive rate limiting) |
| `reset` | (none) | void | Optional. Reset strategy state after success |

**Standard Implementations:**

```text
// Exponential backoff with jitter
ExponentialBackoff({
  maxAttempts: 5,
  initialDelay: 1000,
  maxDelay: 30000,
  jitter: true
})

// Linear backoff
LinearBackoff({
  maxAttempts: 3,
  delay: 2000
})

// No retry
NoRetry()

// Token bucket rate limiting
TokenBucket({
  capacity: 100,
  refillRate: 10  // tokens per second
})

// Honor server Retry-After headers
RetryAfterStrategy({
  fallbackDelay: 5000
})
```

**Custom strategy example:**

```text
class MyCustomStrategy implements RetryStrategy {
  onRetry(error, attempt) {
    if (attempt >= 5) return null  // Stop retrying
    if (error.code == "RATE_LIMITED") return 5000  // 5 second delay
    return 1000  // 1 second delay for other errors
  }
}
```


## HTTP Status Code Mapping

Providers MUST map HTTP status codes to UPP error codes:

| HTTP Status | UPP Error Code |
|-------------|----------------|
| 400 | `INVALID_REQUEST` (or `CONTEXT_LENGTH_EXCEEDED` if indicated) |
| 401 | `AUTHENTICATION_FAILED` |
| 403 | `AUTHENTICATION_FAILED` or `QUOTA_EXCEEDED` |
| 404 | `MODEL_NOT_FOUND` |
| 429 | `RATE_LIMITED` |
| 500, 502, 503 | `PROVIDER_ERROR` |

<Aside type="note">
  Providers should examine error response bodies to determine the most specific error code. For example, a 400 status might be `CONTEXT_LENGTH_EXCEEDED` if the error message indicates the input was too long.
</Aside>