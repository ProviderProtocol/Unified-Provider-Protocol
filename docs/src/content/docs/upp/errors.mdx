---
title: Error Handling
description: UPP error codes, retry strategies, and error normalization.
---

import { Aside, Badge } from '@astrojs/starlight/components';

# Error Handling

<Badge text="UPP-1.3" variant="note" />

UPP provides standardized error handling and retry strategies across all modalities.

## Error Structure

All modalities MUST normalize errors to `UPPError`:

| Field | Type | Description |
|-------|------|-------------|
| `message` | String | Human-readable error message |
| `code` | ErrorCode | Standardized error code |
| `provider` | String | Provider name |
| `modality` | Modality | Which modality: `llm`, `embedding`, `image` |
| `statusCode` | Integer? | HTTP status code if applicable |
| `cause` | Error? | Original underlying error |

**ErrorCode Values:**

`AUTHENTICATION_FAILED`, `RATE_LIMITED`, `CONTEXT_LENGTH_EXCEEDED`, `MODEL_NOT_FOUND`, `INVALID_REQUEST`, `INVALID_RESPONSE`, `CONTENT_FILTERED`, `QUOTA_EXCEEDED`, `PROVIDER_ERROR`, `NETWORK_ERROR`, `TIMEOUT`, `CANCELLED`

**HTTP Status Code Mapping:**

| HTTP Status | Error Code |
|-------------|------------|
| 400 | `INVALID_REQUEST` |
| 401, 403 | `AUTHENTICATION_FAILED` |
| 404 | `MODEL_NOT_FOUND` |
| 429 | `RATE_LIMITED` |
| 5xx | `PROVIDER_ERROR` |

## Retry Strategies

**RetryStrategy Interface:**

```
interface RetryStrategy {
  onRetry(error: UPPError, attempt: Integer): Integer | null | Promise
  beforeRequest?(): Integer | Promise&lt;Integer&gt;
  reset?(): void
}
```

The `onRetry` method MUST return delay in milliseconds before retry, or `null` to stop retrying.

**Standard Implementations:**

| Strategy | Description |
|----------|-------------|
| `ExponentialBackoff(options)` | Exponential backoff with jitter |
| `LinearBackoff(options)` | Fixed delay between retries |
| `NoRetry()` | No automatic retry |


## HTTP Status Code Mapping

Providers MUST map HTTP status codes to UPP error codes:

| HTTP Status | UPP Error Code |
|-------------|----------------|
| 400 | `INVALID_REQUEST` (or `CONTEXT_LENGTH_EXCEEDED` if indicated) |
| 401 | `AUTHENTICATION_FAILED` |
| 403 | `AUTHENTICATION_FAILED` or `QUOTA_EXCEEDED` |
| 404 | `MODEL_NOT_FOUND` |
| 429 | `RATE_LIMITED` |
| 500, 502, 503 | `PROVIDER_ERROR` |

<Aside type="note">
  Providers should examine error response bodies to determine the most specific error code. For example, a 400 status might be `CONTEXT_LENGTH_EXCEEDED` if the error message indicates the input was too long.
</Aside>