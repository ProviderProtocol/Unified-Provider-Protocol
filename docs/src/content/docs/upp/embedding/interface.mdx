---
title: Embedding Interface
description: UPP Embedding interface for vector embeddings.
---

import { Aside, Badge, Card, CardGrid } from '@astrojs/starlight/components';

# Embedding Interface

<Badge text="UPP-1.2.0" variant="note" />

## Function Signature

```text
embedding(options: EmbeddingOptions) -> EmbeddingInstance
```

## Options

**EmbeddingOptions Structure:**

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `model` | ModelReference | Yes | A model reference from a provider factory |
| `config` | ProviderConfig | No | Provider infrastructure configuration |
| `params` | Map | No | Model-specific parameters (dimensions, encoding format, etc.) |

## EmbeddingInstance

**EmbeddingInstance Interface:**

| Method/Property | Type | Description |
|-----------------|------|-------------|
| `embed(input)` | Function | Embed a single input |
| `embedBatch(inputs)` | Function | Embed multiple inputs in a single request |
| `embedMany(inputs, options)` | Function | Embed with automatic batching for large sets |
| `model` | BoundEmbeddingModel | The bound model |
| `params` | Map? | Current parameters |

**EmbeddingInput Type:**

```text
EmbeddingInput = String | TextBlock | ImageBlock
```

**EmbedManyOptions Structure:**

| Field | Type | Description |
|-------|------|-------------|
| `batchSize` | Integer? | Maximum inputs per batch (default: provider limit) |
| `concurrency` | Integer? | Concurrency limit (default: 1) |
| `signal` | AbortSignal? | Abort signal |

## Embedding Results

**Embedding Structure:**

| Field | Type | Description |
|-------|------|-------------|
| `vector` | List&lt;Float&gt; | The embedding vector |
| `dimensions` | Integer | Vector dimensionality |
| `input` | EmbeddingInput | The input that was embedded |
| `tokens` | Integer? | Token count (if available) |

**EmbeddingBatch Structure:**

| Field | Type | Description |
|-------|------|-------------|
| `embeddings` | List&lt;Embedding&gt; | Embeddings in same order as inputs |
| `usage` | EmbeddingUsage | Aggregate usage |

**EmbeddingUsage Structure:**

| Field | Type | Description |
|-------|------|-------------|
| `totalTokens` | Integer | Total tokens processed |

**EmbeddingProgress Structure:**

| Field | Type | Description |
|-------|------|-------------|
| `embeddings` | List&lt;Embedding&gt; | Completed embeddings so far |
| `progress` | ProgressInfo | Progress information |
| `done` | Boolean | True when all complete |

**ProgressInfo Structure:**

| Field | Type | Description |
|-------|------|-------------|
| `completed` | Integer | Number completed |
| `total` | Integer | Total count |
| `percent` | Float | Percentage complete |

## BoundEmbeddingModel

**BoundEmbeddingModel Structure:**

| Field | Type | Description |
|-------|------|-------------|
| `modelId` | String | The model identifier |
| `maxBatchSize` | Integer | Maximum inputs per batch |
| `maxInputLength` | Integer | Maximum input length (tokens or characters) |
| `dimensions` | Integer | Output dimensions (may be configurable) |
| `embed(request)` | Function | Execute embedding request |

**EmbeddingRequest Structure:**

| Field | Type | Description |
|-------|------|-------------|
| `inputs` | List&lt;EmbeddingInput&gt; | Inputs to embed |
| `params` | Map? | Model-specific parameters |
| `config` | ProviderConfig | Provider infrastructure config |
| `signal` | AbortSignal? | Abort signal |

**EmbeddingResponse Structure:**

| Field | Type | Description |
|-------|------|-------------|
| `embeddings` | List&lt;EmbeddingVector&gt; | Embedding vectors with optional token counts |
| `usage` | EmbeddingUsage | Aggregate usage |

**EmbeddingVector Structure:**

| Field | Type | Description |
|-------|------|-------------|
| `vector` | List&lt;Float&gt; | The embedding vector |
| `tokens` | Integer? | Token count |

## Basic Usage

```text
import { embedding } from "upp"
import openai from "upp/openai"

embedder = embedding({
  model: openai("text-embedding-3-large"),
  config: {
    apiKey: env.OPENAI_API_KEY
  },
  params: {
    dimensions: 1536
  }
})

// Single embedding
result = await embedder.embed("What is the capital of France?")
print(result.vector.length)  // 1536
print(result.dimensions)     // 1536

// Batch embedding
batch = await embedder.embedBatch([
  "First document to embed",
  "Second document to embed",
  "Third document to embed"
])

print(batch.embeddings.length)  // 3
print(batch.usage.totalTokens)  // Total tokens used
```

## Large-Scale Embedding

For embedding large document sets:

```text
documents = await loadDocuments()  // 10,000 documents

for await (progress in embedder.embedMany(documents, {
  batchSize: 100,
  concurrency: 2
})) {
  print("Progress:", progress.progress.percent + "%")

  // Process embeddings as they complete
  await storeInVectorDB(progress.embeddings)

  if (progress.done) {
    print("All embeddings complete")
  }
}
```

## Provider-Specific Parameters

Each provider exports its own parameter types (e.g., `OpenAIEmbedParams`, `VoyageEmbedParams`). Consult provider documentation for available options such as output dimensions, encoding formats, and task type hints.

**EmbeddingInputType:**

Some providers distinguish between embeddings optimized for different use cases:

| Value | Description |
|-------|-------------|
| `document` | Optimize embedding for storage/indexing (longer text, corpus documents) |
| `query` | Optimize embedding for search queries (shorter text, retrieval queries) |

Providers that support input type hints (e.g., Voyage, Cohere) MAY produce different embeddings for the same text depending on this value. Providers that do not support this feature MUST ignore the parameter.

```text
// OpenAI embedding params (OpenAIEmbedParams)
{
  dimensions: 1536,
  encoding_format: "float"
}

// Voyage embedding params (VoyageEmbedParams)
{
  input_type: EmbeddingInputType  // "document" or "query"
}
```

## Similarity Utilities

UPP implementations SHOULD provide optional utilities for working with embeddings:

**Cosine Similarity:**

```text
cosineSimilarity(a: List&lt;Float&gt;, b: List&lt;Float&gt;) -> Float
// Returns value between -1 and 1
```

**Euclidean Distance:**

```text
euclideanDistance(a: List&lt;Float&gt;, b: List&lt;Float&gt;) -> Float
// Returns non-negative value
```

**Dot Product:**

```text
dotProduct(a: List&lt;Float&gt;, b: List&lt;Float&gt;) -> Float
```

Usage:

```text
import { cosineSimilarity } from "upp/similarity"

similarity = cosineSimilarity(embedding1.vector, embedding2.vector)
```